<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Toán tiểu học</title>
    <style>
    .question {
        background-color: Indigo;
        padding: 2px 4px;
        font: 90px sans-serif;
        border: 3px solid #000;
        border-color: LightGray DarkGray DarkGray LightGray;
        color: White;
        width: 5em;
        margin: auto;
    }
    
    .button {
        padding: 2px 4px;
        font: 75px sans-serif;
        border: 3px solid #000;
        border-color: LightGray DarkGray DarkGray LightGray;
        color: White;
        width: 3em;
    }
    
    .save {
        background-color: Sienna;
        padding: 2px 4px;
        font: 75px sans-serif;
        border: 3px solid #000;
        border-color: LightGray DarkGray DarkGray LightGray;
        color: White;
        width: 3em;
    }
    
    .text {
        background-color: AliceBlue;
        font: 50px sans-serif;
        color: SlateGray;
    }
    
    .label {
        font: 50px sans-serif;
        color: SlateGray;
    }
    
    .radio {
        width: 3em;
        height: 3em;
    }
    
    .select {
        background-color: AliceBlue;
        font: 50px sans-serif;
        color: SlateGray;
    }
    </style>
    <script type="text/javascript">
    var answer, operator, n1r1, n2r1, n1r2, n2r2, right, wrong, remember, oral;
    var cookie;
    var audio1 = new Audio('well_done.mp3');
    var audio2 = new Audio('on_click_wrong.mp3');

    function  setCookie(cname, cvalue) {
        localStorage.setItem(cname, cvalue);
    }

    function  getCookie(cname) {   
        return  localStorage.getItem(cname);
    }

    function play() {
        right = 0;
        wrong = 0;
        cookie = 0;
        max = 100;
        remember = 1;
        oral = 0;
        cookie = Number(getCookie("cookie"));

        if (cookie != 1) {
            max = 100;
            operator = "4";
            n1r1 = 0;
            n2r1 = 99;
            n1r2 = 0;
            n2r2 = 99;

            f1r1 = 0;
            f2r1 = 10;
            f1r2 = 0;
            f2r2 = 10;

            remember = 1;
            oral = 0;
        } else {
            operator = getCookie("operator");
            n1r1 = Number(getCookie("n1r1"));
            n2r1 = Number(getCookie("n2r1"));
            n1r2 = Number(getCookie("n1r2"));
            n2r2 = Number(getCookie("n2r2"));

            f1r1 = Number(getCookie("f1r1"));
            f2r1 = Number(getCookie("f2r1"));
            f1r2 = Number(getCookie("f1r2"));
            f2r2 = Number(getCookie("f2r2"));
            remember = Number(getCookie("remember"));
            max = Number(getCookie("max"));
            oral = Number(getCookie("oral"));
        }
        //alert(oral);
        show();
    }

    function show() {
        document.getElementById("txtOperator").value = operator;
        document.getElementById("txtN1R1").value = n1r1;
        document.getElementById("txtN2R1").value = n2r1;
        document.getElementById("txtN1R2").value = n1r2;
        document.getElementById("txtN2R2").value = n2r2;

        document.getElementById("txtF1R1").value = f1r1;
        document.getElementById("txtF2R1").value = f2r1;
        document.getElementById("txtF1R2").value = f1r2;
        document.getElementById("txtF2R2").value = f2r2;
        document.getElementById("txtMax").value = max;

        if (remember == 1) {
            document.getElementById("r1").checked = true;
        } else if (remember == 2) {
            document.getElementById("r2").checked = true;
        } else {
            document.getElementById("r3").checked = true;
        }


        if (operator == "2") {
            if (getRandomInt(1, 2) == 1) {
                add();
            } else {
                sub();
            }
        } else if (operator == "3") {
            var rnd = getRandomInt(1, 3);
            if (rnd == 1) {
                add();
            } else if (rnd == 2) {
                sub();
            } else {
                multiple();
            }
        } else if (operator == "4") {
            var rnd = getRandomInt(1, 4);
            if (rnd == 1) {
                add();
            } else if (rnd == 2) {
                sub();
            } else if (rnd == 3) {
                multiple();
            } else {
                divide();
            }
        } else if (operator == "+") {
            add();
        } else if (operator == "-") {
            sub();
        } else if (operator == "x") {
            multiple();
        } else if (operator == ":") {
            divide();
        }

        //alert(oral);
        document.getElementById("oral").checked = (oral == 1);
        document.getElementById('answer').value = "";

        if (oral == 1) {
            //alert(oral);
            document.getElementById("toggleInput").style.display = "none";
            document.getElementById("toggleOral").style.display = "block";

        } else {
            //alert(oral);
            document.getElementById("toggleInput").style.display = "block";
            document.getElementById("toggleOral").style.display = "none";
            document.getElementById("answer").focus();
        }

    }

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function add() {
        var opr, opr1, opr2;
        var value1, value2, value3, value4;
        var rmb = remember;
        if (rmb == 3) {
            rmb = getRandomInt(1, 2);
        }
        opr = getRandomInt(1, 2);

        if (opr == 1) {
            if (rmb == 1) {
                do {
                    opr1 = getRandomInt(n1r1, n2r1);
                    opr2 = getRandomInt(n1r2, n2r2);
                } while ((opr1 % 10 + opr2 % 10) >= 10 || opr1 + opr2 >= max);
            } else {
                do {
                    opr1 = getRandomInt(n1r1, n2r1);
                    opr2 = getRandomInt(n1r2, n2r2);
                } while ((opr1 % 10 + opr2 % 10) < 10 || opr1 + opr2 >= max);
            }
        } else {

            if (rmb == 1) {
                do {
                    opr1 = getRandomInt(n1r2, n2r2);
                    opr2 = getRandomInt(n1r1, n2r1);
                } while ((opr1 % 10 + opr2 % 10) >= 10 || opr1 + opr2 >= max);
            } else {
                do {
                    opr1 = getRandomInt(n1r2, n2r2);
                    opr2 = getRandomInt(n1r1, n2r1);
                } while ((opr1 % 10 + opr2 % 10) < 10 || opr1 + opr2 >= max);
            }
        }

        value = Math.floor(Math.random() * 4) + 1
        if (value == 1) {
            value1 = opr1 + opr2;
            answer = value1;
            value2 = getRandNum(value1, value1 - 10);
            value3 = getRandNum(value1, value1 - 1);
            value4 = getRandNum(value1, value1 + 1);
        } else if (value == 2) {
            value2 = opr1 + opr2;
            answer = value2;
            value1 = getRandNum(value2, value2 - 10);
            value3 = getRandNum(value2, value2 - 1);
            value4 = getRandNum(value2, value2 + 1);
        } else if (value == 3) {
            value3 = opr1 + opr2;
            answer = value3;
            value1 = getRandNum(value3, value3 - 10);
            value2 = getRandNum(value3, value3 - 1);
            value4 = getRandNum(value3, value3 + 1);
        } else {
            value4 = opr1 + opr2;
            answer = value4;
            value1 = getRandNum(value4, value4 - 10);
            value2 = getRandNum(value4, value4 - 1);
            value3 = getRandNum(value4, value4 + 1);
        }

        document.getElementById("operation").innerHTML = opr1 + " + " + opr2 + " =";
        document.getElementById("button1").value = value1;
        document.getElementById("button2").value = value2;
        document.getElementById("button3").value = value3;
        document.getElementById("button4").value = value4;

    }

    function sub() {
        var opr, opr1, opr2;
        var value1, value2, value3, value4;
        var rmb = remember;
        if (rmb == 3) {
            rmb = getRandomInt(1, 2);
        }
        if (rmb == 1) {
            do {
                opr1 = getRandomInt(n1r1, n2r1);
                opr2 = getRandomInt(n1r2, n2r2);
                if (opr1 < opr2) {
                    opr = opr1;
                    opr1 = opr2;
                    opr2 = opr;
                }
            } while ((opr1 % 10 - opr2 % 10) < 0);
        } else {
            do {
                opr1 = getRandomInt(n1r1, n2r1);
                opr2 = getRandomInt(n1r2, n2r2);
                if (opr1 < opr2) {
                    opr = opr1;
                    opr1 = opr2;
                    opr2 = opr;
                }
            } while ((opr1 % 10 - opr2 % 10) >= 0);
        }


        value = Math.floor(Math.random() * 4) + 1
        if (value == 1) {
            value1 = opr1 - opr2;
            answer = value1;
            value2 = getRandNum(value1, value1 - 10);
            value3 = getRandNum(value1, value1 - 1);
            value4 = getRandNum(value1, value1 + 1);
        } else if (value == 2) {
            value2 = opr1 - opr2;
            answer = value2;
            value1 = getRandNum(value2, value2 - 10);
            value3 = getRandNum(value2, value2 - 1);
            value4 = getRandNum(value2, value2 + 1);
        } else if (value == 3) {
            value3 = opr1 - opr2;
            answer = value3;
            value1 = getRandNum(value3, value3 - 10);
            value2 = getRandNum(value3, value3 - 1);
            value4 = getRandNum(value3, value3 + 1);
        } else {
            value4 = opr1 - opr2;
            answer = value4;
            value1 = getRandNum(value4, value4 - 10);
            value2 = getRandNum(value4, value4 - 1);
            value3 = getRandNum(value4, value4 + 1);
        }

        document.getElementById("operation").innerHTML = opr1 + " - " + opr2 + " =";
        document.getElementById("button1").value = value1;
        document.getElementById("button2").value = value2;
        document.getElementById("button3").value = value3;
        document.getElementById("button4").value = value4;

    }

    function multiple() {
        var opr, opr1, opr2;
        var value1, value2, value3, value4;

        opr1 = getRandomInt(f1r1, f2r1);
        opr2 = getRandomInt(f1r2, f2r2);

        value = Math.floor(Math.random() * 4) + 1
        if (value == 1) {
            value1 = opr1 * opr2;
            answer = value1;
            value2 = getRandNum(value1, value1 - 10);
            value3 = getRandNum(value1, value1 - 1);
            value4 = getRandNum(value1, value1 + 1);
        } else if (value == 2) {
            value2 = opr1 * opr2;
            answer = value2;
            value1 = getRandNum(value2, value2 - 10);
            value3 = getRandNum(value2, value2 - 1);
            value4 = getRandNum(value2, value2 + 1);
        } else if (value == 3) {
            value3 = opr1 * opr2;
            answer = value3;
            value1 = getRandNum(value3, value3 - 10);
            value2 = getRandNum(value3, value3 - 1);
            value4 = getRandNum(value3, value3 + 1);
        } else {
            value4 = opr1 * opr2;
            answer = value4;
            value1 = getRandNum(value4, value4 - 10);
            value2 = getRandNum(value4, value4 - 1);
            value3 = getRandNum(value4, value4 + 1);
        }

        document.getElementById("operation").innerHTML = opr1 + " x " + opr2 + " =";
        document.getElementById("button1").value = value1;
        document.getElementById("button2").value = value2;
        document.getElementById("button3").value = value3;
        document.getElementById("button4").value = value4;

    }

    function divide() {
        var opr, opr1, opr2;
        var value1, value2, value3, value4;

        do {
            opr1 = getRandomInt(f1r1, f2r1);
            opr2 = getRandomInt(f1r2, f2r2);
        } while (opr1 == 0 || opr2 == 0);


        value = Math.floor(Math.random() * 4) + 1
        if (value == 1) {
            value1 = opr2;
            answer = value1;
            value2 = getRandNum(value1, value1 - 10);
            value3 = getRandNum(value1, value1 - 1);
            value4 = getRandNum(value1, value1 + 1);
        } else if (value == 2) {
            value2 = opr2;
            answer = value2;
            value1 = getRandNum(value2, value2 - 10);
            value3 = getRandNum(value2, value2 - 1);
            value4 = getRandNum(value2, value2 + 1);
        } else if (value == 3) {
            value3 = opr2;
            answer = value3;
            value1 = getRandNum(value3, value3 - 10);
            value2 = getRandNum(value3, value3 - 1);
            value4 = getRandNum(value3, value3 + 1);
        } else {
            value4 = opr2;
            answer = value4;
            value1 = getRandNum(value4, value4 - 10);
            value2 = getRandNum(value4, value4 - 1);
            value3 = getRandNum(value4, value4 + 1);
        }

        document.getElementById("operation").innerHTML = (opr1 * opr2) + " : " + opr1 + " =";
        document.getElementById("button1").value = value1;
        document.getElementById("button2").value = value2;
        document.getElementById("button3").value = value3;
        document.getElementById("button4").value = value4;

    }

    function getRandNum(v1, v2) {
        if (v2 < -9) {
            v2 = v1 + 10;
        } else if (v2 < 0) {
            v2 = v1 + 9;
        } else if (v2 >= 100) {
            v2 = v1 - 9;
        }
        return v2;
    }

    function check(id) {
        if (document.getElementById(id).value == answer) {
            right += 1;
            document.getElementById("right").innerHTML = right;
            audio1.play();
            show();
        } else {
            wrong += 1;
            document.getElementById("wrong").innerHTML = wrong;
            audio2.play();
            document.getElementById('answer').value = "";
        }
    }

    function toggle() {
        var ele = document.getElementById("toggleConfig");
        //var text = document.getElementById("displayConfig");
        //alert(ele.style.display);
        if (ele.style.display == "block") {
            ele.style.display = "none";
        } else {
            ele.style.display = "block";
        }
    }

    function save() {

        opr = document.getElementById("txtOperator").value;
        v1 = parseInt(document.getElementById("txtN1R1").value);
        v2 = parseInt(document.getElementById("txtN2R1").value);
        v3 = parseInt(document.getElementById("txtN1R2").value);
        v4 = parseInt(document.getElementById("txtN2R2").value);
        v5 = parseInt(document.getElementById("txtF1R1").value);
        v6 = parseInt(document.getElementById("txtF2R1").value);
        v7 = parseInt(document.getElementById("txtF1R2").value);
        v8 = parseInt(document.getElementById("txtF2R2").value);
        max = parseInt(document.getElementById("txtMax").value);
        var ck = document.getElementById("r1").checked;
        if (ck) {
            remember = 1;
        } else if (document.getElementById("r2").checked) {
            remember = 2;
        } else {
            remember = 3;
        }

        oral = document.getElementById("oral").checked ? 1 : 0;
        //alert(oral);
        if (v1 > v2 || v3 > v4 || v5 > v6 || v7 > v8) {
            alert("Dữ liệu trong ô đến nhỏ hơn trong ô từ");
            return;
        } else if (v1 + v3 >= max || v1 < 0 || v3 < 0) {
            alert("Dữ liệu trong ô từ nhỏ hơn 0 hoặc tổng của 2 ô từ lớn hơn hay bằng 100");
            return;
        } else {
            operator = opr;
            n1r1 = v1;
            n2r1 = v2;
            n1r2 = v3;
            n2r2 = v4;
            f1r1 = v5;
            f2r1 = v6;
            f1r2 = v7;
            f2r2 = v8;

            setCookie("cookie", 1);
            setCookie("operator", operator);
            setCookie("n1r1", n1r1);
            setCookie("n2r1", n2r1);
            setCookie("n1r2", n1r2);
            setCookie("n2r2", n2r2);
            setCookie("f1r1", f1r1);
            setCookie("f2r1", f2r1);
            setCookie("f1r2", f1r2);
            setCookie("f2r2", f2r2);
            setCookie("remember", remember);
            setCookie("max", max);
            setCookie("oral", oral);
            toggle();
            show();

        }

    }
    </script>
</head>

<body onload="play()">
    <form align="center">
        <div class="label" align="center">
            <label style="color:green">&#10003</label>
            <label style="color:CornFlowerBlue" id="right">0</label>
            <label style="color:red">&#10007</label>
            <label style="color:CornFlowerBlue" id="wrong">0</label>
            &nbsp;&nbsp;&nbsp;
            <img src="Glass_Hour.png" alt="Time: " style="width:31px;height:44px;">
            <label style="color:Chocolate" id="wrong">0:00:00</label>
        </div>
        <br>
        <div class="question" align="center" style="vertical-align: middle;">
            <label id="operation"></label>
        </div>
        <br>
        <div class="label" id="toggleInput" style="display: block">
            <input type="number" id="answer" class="text" style="width:3em"></input>&nbsp;&nbsp;&nbsp;
            <input type="button" id="check_answer" value="OK" onclick="check('answer')" class="button" style="background-color:Brown; font:50px sans-serif;"></input>
        </div>
        <div class="label" id="toggleOral" style="display: none">
            <input type="button" id="button1" onclick="check('button1')" class="button" align="center" style="background-color:HotPink "></input>
            <input type="button" id="button2" onclick="check('button2')" class="button" align="center" style="background-color:Green "></input>
            <input type="button" id="button3" onclick="check('button3')" class="button" align="center" style="background-color:Blue "></input>
            <input type="button" id="button4" onclick="check('button4')" class="button" align="center" style="background-color:DarkMagenta"></input>
        </div>
    </form>
    <br>
    <br>
    <a class="label" id="displayConfig" href="javascript:toggle();">Cấu hình</a>
    <div class="label" id="toggleConfig" style="display: none" align="left">
        <br>
        <input type="radio" name="gr1" id="r1" value="1" class="radio" checked/>
        <label for="r1">Không nhớ</label>&nbsp;&nbsp;&nbsp;
        <input type="radio" name="gr1" id="r2" value="2" class="radio" />
        <label for="r2">Có nhớ</label>&nbsp;&nbsp;&nbsp;
        <input type="radio" name="gr1" id="r3" value="3" class="radio" />
        <label for="r3">Hỗn hợp</label>
        <br>
        <br> Max:
        <input type="text" class="text" id="txtMax" style="text-align:center" size="5" />
        <br>
        <br> Phép toán:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <select class="select" id="txtOperator">
            <option value="+">+</option>
            <option value="-">-</option>
            <option value="x">x</option>
            <option value=":">:</option>
            <option value="2">+-</option>
            <option value="3">+-x</option>
            <option value="4">+-x:</option>
        </select>
        <br>
        <br> Toán hạng 1 - Từ:
        <input type="text" class="text" id="txtN1R1" style="text-align:center" size="3" maxlength="3" /> đến
        <input type="text" class="text" id="txtN2R1" style="text-align:center" size="3" maxlength="3" />
        <br>
        <br> Toán hạng 2 - Từ:
        <input type="text" class="text" id="txtN1R2" style="text-align:center" size="3" maxlength="3" /> đến
        <input type="text" class="text" id="txtN2R2" style="text-align:center" size="3" maxlength="3" />
        <br>
        <br> Thừa số 1 - Từ:
        <input type="text" class="text" id="txtF1R1" style="text-align:center" size="3" maxlength="3" /> đến
        <input type="text" class="text" id="txtF2R1" style="text-align:center" size="3" maxlength="3" />
        <br>
        <br> Thừa số 2 - Từ:
        <input type="text" class="text" id="txtF1R2" style="text-align:center" size="3" maxlength="3" /> đến
        <input type="text" class="text" id="txtF2R2" style="text-align:center" size="3" maxlength="3" />
        <br>
        <br>
        <input type="checkbox" id="oral" style="width:3em;height:3em">Trắc nghiệm</input>
        <br>
        <br>
        <input type="button" class="save" id="save" value="Lưu" onclick="save()" />
    </div>
</body>

</html>
